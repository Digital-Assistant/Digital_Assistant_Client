{"version":3,"file":"UDABackground.js","mappings":";;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;ACrNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;ACvLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;;AC3BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AA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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AAAA;AAAA;AAGA;AAAA;AAeA;AAAA;AAfA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AAFA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA","sources":["webpack://UdanLibrary/./node_modules/detect-browser/es/index.js","webpack://UdanLibrary/./node_modules/process/browser.js","webpack://UdanLibrary/./src/util/UDADigestMessage.ts","webpack://UdanLibrary/./src/util/invokeApi.ts","webpack://UdanLibrary/webpack/bootstrap","webpack://UdanLibrary/webpack/runtime/define property getters","webpack://UdanLibrary/webpack/runtime/hasOwnProperty shorthand","webpack://UdanLibrary/webpack/runtime/make namespace object","webpack://UdanLibrary/./src/Background.js"],"sourcesContent":["var __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar BrowserInfo = /** @class */ (function () {\n    function BrowserInfo(name, version, os) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.type = 'browser';\n    }\n    return BrowserInfo;\n}());\nexport { BrowserInfo };\nvar NodeInfo = /** @class */ (function () {\n    function NodeInfo(version) {\n        this.version = version;\n        this.type = 'node';\n        this.name = 'node';\n        this.os = process.platform;\n    }\n    return NodeInfo;\n}());\nexport { NodeInfo };\nvar SearchBotDeviceInfo = /** @class */ (function () {\n    function SearchBotDeviceInfo(name, version, os, bot) {\n        this.name = name;\n        this.version = version;\n        this.os = os;\n        this.bot = bot;\n        this.type = 'bot-device';\n    }\n    return SearchBotDeviceInfo;\n}());\nexport { SearchBotDeviceInfo };\nvar BotInfo = /** @class */ (function () {\n    function BotInfo() {\n        this.type = 'bot';\n        this.bot = true; // NOTE: deprecated test name instead\n        this.name = 'bot';\n        this.version = null;\n        this.os = null;\n    }\n    return BotInfo;\n}());\nexport { BotInfo };\nvar ReactNativeInfo = /** @class */ (function () {\n    function ReactNativeInfo() {\n        this.type = 'react-native';\n        this.name = 'react-native';\n        this.version = null;\n        this.os = null;\n    }\n    return ReactNativeInfo;\n}());\nexport { ReactNativeInfo };\n// tslint:disable-next-line:max-line-length\nvar SEARCHBOX_UA_REGEX = /alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/;\nvar SEARCHBOT_OS_REGEX = /(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\\ Jeeves\\/Teoma|ia_archiver)/;\nvar REQUIRED_VERSION_PARTS = 3;\nvar userAgentRules = [\n    ['aol', /AOLShield\\/([0-9\\._]+)/],\n    ['edge', /Edge\\/([0-9\\._]+)/],\n    ['edge-ios', /EdgiOS\\/([0-9\\._]+)/],\n    ['yandexbrowser', /YaBrowser\\/([0-9\\._]+)/],\n    ['kakaotalk', /KAKAOTALK\\s([0-9\\.]+)/],\n    ['samsung', /SamsungBrowser\\/([0-9\\.]+)/],\n    ['silk', /\\bSilk\\/([0-9._-]+)\\b/],\n    ['miui', /MiuiBrowser\\/([0-9\\.]+)$/],\n    ['beaker', /BeakerBrowser\\/([0-9\\.]+)/],\n    ['edge-chromium', /EdgA?\\/([0-9\\.]+)/],\n    [\n        'chromium-webview',\n        /(?!Chrom.*OPR)wv\\).*Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/,\n    ],\n    ['chrome', /(?!Chrom.*OPR)Chrom(?:e|ium)\\/([0-9\\.]+)(:?\\s|$)/],\n    ['phantomjs', /PhantomJS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['crios', /CriOS\\/([0-9\\.]+)(:?\\s|$)/],\n    ['firefox', /Firefox\\/([0-9\\.]+)(?:\\s|$)/],\n    ['fxios', /FxiOS\\/([0-9\\.]+)/],\n    ['opera-mini', /Opera Mini.*Version\\/([0-9\\.]+)/],\n    ['opera', /Opera\\/([0-9\\.]+)(?:\\s|$)/],\n    ['opera', /OPR\\/([0-9\\.]+)(:?\\s|$)/],\n    ['pie', /^Microsoft Pocket Internet Explorer\\/(\\d+\\.\\d+)$/],\n    ['pie', /^Mozilla\\/\\d\\.\\d+\\s\\(compatible;\\s(?:MSP?IE|MSInternet Explorer) (\\d+\\.\\d+);.*Windows CE.*\\)$/],\n    ['netfront', /^Mozilla\\/\\d\\.\\d+.*NetFront\\/(\\d.\\d)/],\n    ['ie', /Trident\\/7\\.0.*rv\\:([0-9\\.]+).*\\).*Gecko$/],\n    ['ie', /MSIE\\s([0-9\\.]+);.*Trident\\/[4-7].0/],\n    ['ie', /MSIE\\s(7\\.0)/],\n    ['bb10', /BB10;\\sTouch.*Version\\/([0-9\\.]+)/],\n    ['android', /Android\\s([0-9\\.]+)/],\n    ['ios', /Version\\/([0-9\\._]+).*Mobile.*Safari.*/],\n    ['safari', /Version\\/([0-9\\._]+).*Safari/],\n    ['facebook', /FB[AS]V\\/([0-9\\.]+)/],\n    ['instagram', /Instagram\\s([0-9\\.]+)/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Mobile/],\n    ['ios-webview', /AppleWebKit\\/([0-9\\.]+).*Gecko\\)$/],\n    ['curl', /^curl\\/([0-9\\.]+)$/],\n    ['searchbot', SEARCHBOX_UA_REGEX],\n];\nvar operatingSystemRules = [\n    ['iOS', /iP(hone|od|ad)/],\n    ['Android OS', /Android/],\n    ['BlackBerry OS', /BlackBerry|BB10/],\n    ['Windows Mobile', /IEMobile/],\n    ['Amazon OS', /Kindle/],\n    ['Windows 3.11', /Win16/],\n    ['Windows 95', /(Windows 95)|(Win95)|(Windows_95)/],\n    ['Windows 98', /(Windows 98)|(Win98)/],\n    ['Windows 2000', /(Windows NT 5.0)|(Windows 2000)/],\n    ['Windows XP', /(Windows NT 5.1)|(Windows XP)/],\n    ['Windows Server 2003', /(Windows NT 5.2)/],\n    ['Windows Vista', /(Windows NT 6.0)/],\n    ['Windows 7', /(Windows NT 6.1)/],\n    ['Windows 8', /(Windows NT 6.2)/],\n    ['Windows 8.1', /(Windows NT 6.3)/],\n    ['Windows 10', /(Windows NT 10.0)/],\n    ['Windows ME', /Windows ME/],\n    ['Windows CE', /Windows CE|WinCE|Microsoft Pocket Internet Explorer/],\n    ['Open BSD', /OpenBSD/],\n    ['Sun OS', /SunOS/],\n    ['Chrome OS', /CrOS/],\n    ['Linux', /(Linux)|(X11)/],\n    ['Mac OS', /(Mac_PowerPC)|(Macintosh)/],\n    ['QNX', /QNX/],\n    ['BeOS', /BeOS/],\n    ['OS/2', /OS\\/2/],\n];\nexport function detect(userAgent) {\n    if (!!userAgent) {\n        return parseUserAgent(userAgent);\n    }\n    if (typeof document === 'undefined' &&\n        typeof navigator !== 'undefined' &&\n        navigator.product === 'ReactNative') {\n        return new ReactNativeInfo();\n    }\n    if (typeof navigator !== 'undefined') {\n        return parseUserAgent(navigator.userAgent);\n    }\n    return getNodeVersion();\n}\nfunction matchUserAgent(ua) {\n    // opted for using reduce here rather than Array#first with a regex.test call\n    // this is primarily because using the reduce we only perform the regex\n    // execution once rather than once for the test and for the exec again below\n    // probably something that needs to be benchmarked though\n    return (ua !== '' &&\n        userAgentRules.reduce(function (matched, _a) {\n            var browser = _a[0], regex = _a[1];\n            if (matched) {\n                return matched;\n            }\n            var uaMatch = regex.exec(ua);\n            return !!uaMatch && [browser, uaMatch];\n        }, false));\n}\nexport function browserName(ua) {\n    var data = matchUserAgent(ua);\n    return data ? data[0] : null;\n}\nexport function parseUserAgent(ua) {\n    var matchedRule = matchUserAgent(ua);\n    if (!matchedRule) {\n        return null;\n    }\n    var name = matchedRule[0], match = matchedRule[1];\n    if (name === 'searchbot') {\n        return new BotInfo();\n    }\n    // Do not use RegExp for split operation as some browser do not support it (See: http://blog.stevenlevithan.com/archives/cross-browser-split)\n    var versionParts = match[1] && match[1].split('.').join('_').split('_').slice(0, 3);\n    if (versionParts) {\n        if (versionParts.length < REQUIRED_VERSION_PARTS) {\n            versionParts = __spreadArray(__spreadArray([], versionParts, true), createVersionParts(REQUIRED_VERSION_PARTS - versionParts.length), true);\n        }\n    }\n    else {\n        versionParts = [];\n    }\n    var version = versionParts.join('.');\n    var os = detectOS(ua);\n    var searchBotMatch = SEARCHBOT_OS_REGEX.exec(ua);\n    if (searchBotMatch && searchBotMatch[1]) {\n        return new SearchBotDeviceInfo(name, version, os, searchBotMatch[1]);\n    }\n    return new BrowserInfo(name, version, os);\n}\nexport function detectOS(ua) {\n    for (var ii = 0, count = operatingSystemRules.length; ii < count; ii++) {\n        var _a = operatingSystemRules[ii], os = _a[0], regex = _a[1];\n        var match = regex.exec(ua);\n        if (match) {\n            return os;\n        }\n    }\n    return null;\n}\nexport function getNodeVersion() {\n    var isNode = typeof process !== 'undefined' && process.version;\n    return isNode ? new NodeInfo(process.version.slice(1)) : null;\n}\nfunction createVersionParts(count) {\n    var output = [];\n    for (var ii = 0; ii < count; ii++) {\n        output.push('0');\n    }\n    return output;\n}\n","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\n/**\r\n *\r\n * @param textMessage\r\n * @param algorithm\r\n * @returns {Promise<ArrayBuffer>}\r\n * @constructor\r\n *\r\n * This is used for encrypting text messages as specified in the docs\r\n * https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest\r\n *\r\n */\r\nexport const UDADigestMessage = (textMessage, algorithm) => __awaiter(void 0, void 0, void 0, function* () {\r\n    const encoder = new TextEncoder();\r\n    const data = encoder.encode(textMessage);\r\n    const hash = yield crypto.subtle.digest(algorithm, data);\r\n    const hashArray = Array.from(new Uint8Array(hash)); // convert buffer to byte array\r\n    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string\r\n    return hashHex;\r\n});\r\n","/**\r\n * Common API call functionality\r\n */\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nexport const invokeApi = (url, method, data, parseJson = true) => __awaiter(void 0, void 0, void 0, function* () {\r\n    try {\r\n        const config = {\r\n            method: method,\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'charset': 'UTF-8'\r\n            }\r\n        };\r\n        if (data) {\r\n            config.body = JSON.stringify(data);\r\n        }\r\n        const baseProdURL = process.env.baseProdURL;\r\n        const baseTestURL = process.env.baseTestURL;\r\n        let baseURL = baseProdURL;\r\n        if (url.indexOf(\"http\") === -1) {\r\n            if (UDAGlobalConfig.environment === 'TEST') {\r\n                baseURL = baseTestURL;\r\n            }\r\n            url = baseURL + url;\r\n        }\r\n        let response = yield fetch(url, config);\r\n        if (response.ok) {\r\n            if (parseJson) {\r\n                return response.json();\r\n            }\r\n            else {\r\n                return response.text();\r\n            }\r\n        }\r\n        else {\r\n            return false;\r\n        }\r\n    }\r\n    catch (e) {\r\n        console.log(e);\r\n        return false;\r\n    }\r\n});\r\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","'use strict';\r\n\r\nimport {UDADigestMessage} from \"./util/UDADigestMessage\";\r\nimport {invokeApi} from \"./util/invokeApi\";\r\n\r\nconst { detect } = require('detect-browser');\r\nconst browser = detect();\r\n\r\nlet enablePlugin = false;\r\n\r\nlet browserVar;\r\n\r\nconsole.log(browser.name);\r\n\r\nswitch (browser && browser.name) {\r\n\tcase 'edge-chromium':\r\n\tcase 'edge':\r\n\tcase 'edge-ios':\r\n\tcase 'chrome':\r\n\t\tenablePlugin = true;\r\n\t\tbrowserVar = chrome;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tbrowserVar = browser;\r\n\t\tbreak;\r\n}\r\n\r\n\r\nlet UDADebug = false; //this variable exists in links.js file also\r\nconst apiHost = process.env.baseURL;\r\nconst cookieName = \"uda-sessiondata\";\r\nconst CSPStorageName = \"uda-csp-storage\";\r\nconst activeTabs = [];\r\nconst sessionKey = \"\";\r\nlet sessionData = {\r\n\tsessionkey: \"\",\r\n\tauthenticated: false,\r\n\tauthenticationsource: \"\",\r\n\tauthdata: {},\r\n\tcsp: {cspenabled: false, udanallowed: true, domain: ''}\r\n};\r\n\r\nlet currentTab = [];\r\n\r\n\r\nlet activeTabId;\r\n\r\n/**\r\n * Storing the active tab id to fetch for further data.\r\n */\r\nbrowserVar.tabs.onActivated.addListener(function (activeInfo) {\r\n\tactiveTabId = activeInfo.tabId;\r\n});\r\n\r\n//login with browser identity functionality\r\nasync function loginWithBrowser() {\r\n\tsessionData.authenticationsource = \"google\";\r\n\tbrowserVar.identity.getProfileUserInfo({accountStatus: 'ANY'}, async function (data) {\r\n\t\tif (data.id !== '' && data.email !== \"\") {\r\n\t\t\tsessionData.authenticated = true;\r\n\t\t\tsessionData.authdata = data;\r\n\t\t\tUDADigestMessage(sessionData.authdata.id, \"SHA-512\").then(async (encryptedid) => {\r\n\t\t\t\tsessionData.authdata.id = encryptedid;\r\n\t\t\t\tUDADigestMessage(sessionData.authdata.email, \"SHA-512\").then(async (encryptedemail) => {\r\n\t\t\t\t\tsessionData.authdata.email = encryptedemail;\r\n\t\t\t\t\tawait bindAuthenticatedAccount();\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tawait sendSessionData(\"UDAAlertMessageData\", \"login\")\r\n\t\t}\r\n\t});\r\n\treturn true;\r\n}\r\n\r\n//send the sessiondata to the webpage functionality\r\nasync function sendSessionData(sendaction = \"UDAUserSessionData\", message = '') {\r\n\tlet tab = await getTab();\r\n\tif (sendaction === \"UDAAlertMessageData\") {\r\n\t\tawait browserVar.tabs.sendMessage(tab.id, {action: sendaction, data: message});\r\n\t\treturn true;\r\n\t} else {\r\n\t\tlet url = new URL(tab.url);\r\n\t\tlet domain = url.protocol + '//' + url.hostname;\r\n\t\tlet cspRecord = {cspenabled: false, udanallowed: true, domain: ''};\r\n\t\tlet cspData = getstoragedata(CSPStorageName);\r\n\t\tlet recordExists = false;\r\n\t\tif (cspData) {\r\n\t\t\tlet cspRecords = cspData;\r\n\t\t\tif (cspRecords.length > 0) {\r\n\t\t\t\tfor (let i = 0; i < cspRecords.length; i++) {\r\n\t\t\t\t\tif (cspRecords[i].domain === domain) {\r\n\t\t\t\t\t\trecordExists = true;\r\n\t\t\t\t\t\tcspRecord = cspRecords[i];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (recordExists) {\r\n\t\t\t\t\tsessionData.csp = cspRecord;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tsessionData.csp = cspRecord;\r\n\t\tconsole.log(sessionData);\r\n\t\tawait browserVar.tabs.sendMessage(tab.id, {action: sendaction, data: JSON.stringify(sessionData)});\r\n\t\treturn true;\r\n\t}\r\n}\r\n\r\n/**\r\n *\r\n * @returns {currentTab}\r\n */\r\nasync function getTab() {\r\n\tlet queryOptions = {active: true, currentWindow: true};\r\n\tlet tab = (await browserVar.tabs.query(queryOptions))[0];\r\n\t// let tab = await browserVar.tabs.getCurrent();\r\n\tif (tab) {\r\n\t\treturn tab;\r\n\t} else {\r\n\t\ttab = await browserVar.tabs.get(activeTabId);\r\n\t\tif (tab) {\r\n\t\t\treturn tab;\r\n\t\t} else {\r\n\t\t\tconsole.log('No active tab identified.');\r\n\t\t}\r\n\t}\r\n\treturn tab;\r\n}\r\n\r\n// listen for the requests made from webpage for accessing userdata\r\nbrowserVar.runtime.onMessage.addListener(async function (request, sender, sendResponse) {\r\n\tconsole.log(request);\r\n\tif (request.action === \"getusersessiondata\") {\r\n\t\tbrowserVar.storage.local.get([cookieName], async function (storedsessiondata) {\r\n\t\t\tif (browserVar.runtime.lastError) {\r\n\t\t\t\tconsole.log('failed to read stored session data');\r\n\t\t\t} else {\r\n\t\t\t\t// looks like browser storage might have changed so changing the reading the data has been changed. For to work with old version have added the new code to else if statement\r\n\t\t\t\tif (storedsessiondata.hasOwnProperty(\"sessionkey\") && storedsessiondata[\"sessionKey\"] && typeof storedsessiondata[\"sessionKey\"] != 'object') {\r\n\t\t\t\t\tsessionData = storedsessiondata;\r\n\t\t\t\t\tif(storedsessiondata.hasOwnProperty('authenticated') && storedsessiondata.authenticated) {\r\n\t\t\t\t\t\tawait sendSessionData();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tawait loginWithBrowser();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (storedsessiondata.hasOwnProperty(cookieName) && storedsessiondata[cookieName].hasOwnProperty(\"sessionkey\") && storedsessiondata[cookieName][\"sessionKey\"] && typeof storedsessiondata[cookieName][\"sessionKey\"] != 'object') {\r\n\t\t\t\t\tsessionData = storedsessiondata[cookieName];\r\n\t\t\t\t\t// await sendSessionData();\r\n\t\t\t\t\tif(storedsessiondata.hasOwnProperty('authenticated') && storedsessiondata.authenticated) {\r\n\t\t\t\t\t\tawait sendSessionData();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tawait loginWithBrowser();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tawait getSessionKey(false);\r\n\t\t\t\t\tawait loginWithBrowser();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t} else if (request.action === \"authtenicate\") {\r\n\t\tawait loginWithBrowser();\r\n\t} else if (request.action === \"Debugvalueset\") {\r\n\t\tUDADebug = request.data;\r\n\t} else if (request.action === \"createSession\") {\r\n\t\tawait keycloakStore(request.data);\r\n\t}\r\n});\r\n\r\n//storing the data to the browser storage\r\nasync function storeSessionData() {\r\n\tlet storageData = {};\r\n\tstorageData[cookieName] = sessionData;\r\n\tawait browserVar.storage.local.set(storageData);\r\n\treturn true;\r\n}\r\n\r\n//getting the sessionkey from backend server\r\nasync function getSessionKey(senddata = true) {\r\n\tlet response = await invokeApi(apiHost + \"/user/getsessionkey\", \"GET\", null, false);\r\n\tconsole.log(response);\r\n\tif(!response){\r\n\t\treturn response;\r\n\t}\r\n\tsessionData.sessionkey = response;\r\n\tawait storeSessionData();\r\n\tif(senddata){\r\n\t\tawait sendSessionData();\r\n\t}\r\n\r\n}\r\n\r\n//binding the sessionkey and browser identity id\r\nasync function bindAuthenticatedAccount() {\r\n\tlet authdata = {\r\n\t\tauthid: sessionData.authdata.id,\r\n\t\temailid: (sessionData.authdata.email)?sessionData.authdata.email:'',\r\n\t\tauthsource: sessionData.authenticationsource\r\n\t};\r\n\tlet response = await invokeApi(apiHost + \"/user/checkauthid\", \"POST\", authdata);\r\n\tif(response) {\r\n\t\tawait bindAccount(response);\r\n\t\treturn true;\r\n\t} else {\r\n\t\treturn response;\r\n\t}\r\n}\r\n\r\n//binding the session to the authid\r\nasync function bindAccount(userauthdata) {\r\n\tconst usersessiondata = {userauthid: userauthdata.id, usersessionid: sessionData.sessionkey};\r\n\tlet response = await invokeApi(apiHost + \"/user/checkusersession\", \"POST\", usersessiondata);\r\n\tawait storeSessionData();\r\n\tawait sendSessionData(\"UDAAuthenticatedUserSessionData\");\r\n\treturn true;\r\n}\r\n\r\nfunction CheckCSPStorage(cspenabled = false, udanallowed = false, domain) {\r\n\tconst csprecord = {cspenabled, udanallowed, domain};\r\n\tlet cspdata = getstoragedata(CSPStorageName);\r\n\tif (cspdata) {\r\n\t\tlet csprecords = cspdata;\r\n\t\tif (csprecords.length > 0) {\r\n\t\t\tlet recordexists = false;\r\n\t\t\tfor (let i = 0; i < csprecords.length; i++) {\r\n\t\t\t\tlet record = csprecords[i];\r\n\t\t\t\tif (record.domain === domain) {\r\n\t\t\t\t\trecordexists = true;\r\n\t\t\t\t\tcsprecords[i] = csprecord;\r\n\t\t\t\t\tcreatestoragedata(CSPStorageName, csprecords);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!recordexists) {\r\n\t\t\t\tcsprecords.push(csprecord);\r\n\t\t\t\tcreatestoragedata(CSPStorageName, csprecords);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tcsprecords.push(csprecord);\r\n\t\t\tcreatestoragedata(CSPStorageName, csprecords);\r\n\t\t}\r\n\t} else {\r\n\t\tvar csprecords = [];\r\n\t\tcsprecords.push(csprecord);\r\n\t\tcreatestoragedata(CSPStorageName, csprecords);\r\n\t}\r\n}\r\n\r\nfunction createstoragedata(key, value) {\r\n\ttry {\r\n\t\tlocalStorage.setItem(key, JSON.stringify(value));\r\n\t\treturn true;\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction getstoragedata(key) {\r\n\ttry {\r\n\t\tconst result = localStorage.getItem(key);\r\n\t\treturn JSON.parse(result);\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nfunction ProcessCSPValues(value = '', domain) {\r\n\tlet udanallowed = false;\r\n\tlet cspenabled = true;\r\n\tif (value) {\r\n\t\tlet allowedSrcs = value.split(\";\");\r\n\t\tif (allowedSrcs.length > 0) {\r\n\t\t\tfor (let i = 0; i < allowedSrcs.length; i++) {\r\n\t\t\t\tlet allowedSrc = allowedSrcs[i];\r\n\t\t\t\tlet allowedDomains = allowedSrc.split(' ');\r\n\t\t\t\tif (allowedDomains.length > 1 && allowedDomains[0].toLowerCase() === 'default-src') {\r\n\t\t\t\t\tfor (let index = 0; index < allowedDomains.length; index++) {\r\n\t\t\t\t\t\tlet allowedDomain = allowedDomains[index];\r\n\t\t\t\t\t\tif (allowedDomain === 'default-src') {\r\n\t\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tswitch (allowedDomain.toLowerCase()) {\r\n\t\t\t\t\t\t\tcase '*':\r\n\t\t\t\t\t\t\tcase 'https:':\r\n\t\t\t\t\t\t\t\tudanallowed = true;\r\n\t\t\t\t\t\t\t\tcspenabled = true;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (allowedDomains.length > 0 && allowedDomains[0].toLowerCase() === 'default-src') {\r\n\t\t\t\t\tudanallowed = true;\r\n\t\t\t\t\tcspenabled = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t} else {\r\n\t\tudanallowed = true;\r\n\t\tcspenabled = true;\r\n\t}\r\n\tCheckCSPStorage(cspenabled, udanallowed, domain);\r\n}\r\n\r\nlet onHeadersReceived = function (details) {\r\n\tlet url = new URL(details.url);\r\n\tconst domain = url.protocol + '//' + url.hostname;\r\n\tfor (let i = 0; i < details.responseHeaders.length; i++) {\r\n\t\tif (details.responseHeaders[i].name.toLowerCase() === 'content-security-policy') {\r\n\t\t\tProcessCSPValues(details.responseHeaders[i].value, domain);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nlet onHeaderFilter = {urls: ['*://*/*'], types: ['main_frame']};\r\n\r\n// commented the CSP checking code functionality\r\n/*browserVar.declarativeNetRequest.onHeadersReceived.addListener(\r\n\tonHeadersReceived, onHeaderFilter, ['blocking', 'responseHeaders']\r\n);*/\r\n\r\n/**\r\n * Store keycloak data in browser extension storage for retrival for other sites\r\n */\r\nasync function keycloakStore(data){\r\n\tconsole.log('creating session at extension');\r\n\tsessionData.authenticationsource = 'keycloak';\r\n\tsessionData.authenticated = true;\r\n\tsessionData.authdata = data;\r\n\tawait getSessionKey(false);\r\n\tawait bindAuthenticatedAccount();\r\n}\r\n\r\n"],"names":[],"sourceRoot":""}